#summary Guide to using xUmlCompiler

= xUmlCompiler User's Guide =
==Introduction==
==Define a system==
Consider this class diagram:

http://xuml-compiler.googlecode.com/svn/trunk/xUmlCompiler/docs/wiki/class1.png

To define this system create this class:

{{{
package moten.david.uml.xuml.model.example.shop;

import java.io.IOException;

import model.AssociationClass;
import model.Class;
import model.Primitive;
import moten.david.uml.xuml.model.Multiplicity;
import moten.david.uml.xuml.model.util.SystemBase;

public class Shop extends SystemBase {

	private static final String schema = "SHOP";
	private static final String systemName = "Shop";

	public Shop() {
		super(schema, systemName);
		initialize();
	}

	private void initialize() {
		model.Package pkg = createRootPackage("shop", "shop system");
		Class customer = createClassWithArbitraryId(pkg, "Customer",
				"a shop customer, a potential or actual purchaser of products from the shop");
		createAttribute(customer, "name");
		createAttribute(customer, "billingName");
		createAttribute(customer, "billingAddress");
		createAttribute(customer, "shippingName");
		createAttribute(customer, "shippingAddress");

		Class order = createClassWithArbitraryId(pkg, "Order",
				"an order of products made by a customer");
		createAttribute(order, "timeCreated", Primitive.TIMESTAMP);

		Class product = createClassWithArbitraryId(pkg, "Product", "products");
		createAttribute(product, "numberInStock", Primitive.INTEGER);
		createAttribute(product, "numberCommitted", Primitive.INTEGER);

		AssociationClass orderProduct = createAssociationClassWithArbitraryId(
				pkg, "OrderProduct", "products on an order");
		createAttribute(orderProduct, "itemCount", Primitive.INTEGER);

		Class shipment = createClassWithArbitraryId(pkg, "Shipment",
				"shipment of an order");
		createAttribute(shipment, "timePacked", Primitive.TIMESTAMP);
		createAttribute(shipment, "timeSent", Primitive.TIMESTAMP);
		createAttribute(shipment, "timeUnpacked", Primitive.TIMESTAMP);
		createAttribute(shipment, "comment");

		createAssociation("R1", createAssociationEndPrimary(customer,
				Multiplicity.ONE, "is made by"), createAssociationEndSecondary(
				order, Multiplicity.MANY, "makes"));
		createAssociation("R2", createAssociationEndPrimary(order,
				Multiplicity.ONE, "delivers"), createAssociationEndSecondary(
				shipment, Multiplicity.ZERO_ONE, "is delivered by"));

		createAssociation(
				"R3",
				createAssociationEndPrimary(order, Multiplicity.MANY,
						"is included in"),
				createAssociationEndSecondary(product, Multiplicity.MANY,
						"includes")).setAssociationClass(orderProduct);

	}

	public static void main(String[] args) throws NumberFormatException,
			IOException {
		Shop shop = new Shop();
		shop.view("src/viewer/Shop.ini");
	}  

}

}}}
==View the system==
Before you run the viewer you need to indicate where you are going to save the setttings for the view of the Shop system. The file is currently set to be _Shop.ini_ in the java working directory. Change it if you like.

To view the system, run the above class (the main method calls the viewer). You will need to reposition the elements but when you close the viewer the positions will be saved automatically.
 
You may want to change the name of the location of the settings file in the main method.

When you run the viewer you will see an image 

==Add the State Machine==
Now we add in the state machine details to the Shop class:

==Add methods to the classes==
Add this code to the end of the initialize() method: 

{{{
    createOperation(order, "dispatch", "dispatches the order", null, false);
    createOperation(
        customer,
        "getCreditRating",
        "gets the credit rating",
        "Integer", false);
}}}

Run the viewer and we see the new operations in the classes.

http://xuml-compiler.googlecode.com/svn/trunk/xUmlCompiler/docs/guide/images/img03.jpg

==Generate the classes==
xUmlCompiler generates
  * entity classes with ejb3 annotations (and possible hibernate specific annotations)
  * interfaces for all entities
  * object factory classes
  * injector classes for late binding of actions
  * search classes based on identifier and index specifications 
  * value enumerations for static constants associated with attributes

Paste in the following class:
{{{
package moten.david.uml.xuml.model.example.shop;

public class ShopGenerator {

    public static void main(String[] args) throws Exception {
        Shop shop = new Shop();
        shop.generate("temp/shop");
    }
}
}}}
All classes will be written to the directory temp/shop. Change it if you wish. Create the directory if it does not exist.

Run the main method in the above class and classes will be generated as below:

http://xuml-compiler.googlecode.com/svn/trunk/xUmlCompiler/docs/guide/images/img04.jpg

Notice the getter and setter methods on the Customer interface class and the search methods. If we had defined identifiers (uniqueness rules other than the primary key id field) we would see finders for the identifier attribute groups as well.  

http://xuml-compiler.googlecode.com/svn/trunk/xUmlCompiler/docs/guide/images/img05.jpg

==Implement actions==
All methods and state machine entry points should be implemented by your behaviour classes.

Here's the behaviour class for the Order class:
{{{
package moten.david.uml.xuml.model.example.shop;

import shop.Order;
import shop.actions.OrderActions;

public class OrderBehaviour implements OrderActions {

    private Order order;

    @Override
    public void dispatch() {
        System.out.println("dispatching order " + order.getId());
    }

    @Override
    public void setOrder(Order order) {
        this.order = order;
    }

}
}}}
==Define an injector==
{{{
package moten.david.uml.xuml.model.example.shop;

import shop.actions.OrderActions;

import com.google.inject.AbstractModule;

public class ShopInjectorModule extends AbstractModule {

     @Override
     protected void configure() {
          bind(OrderActions.class).to(OrderBehaviour.class);
     }

}
}}}
==Execute the system==
To execute the system we must first ensure that the generated objects use the shop InjectorModule for late bound injection of behaviour:
{{{
package moten.david.uml.xuml.model.example.shop;

import shop.ObjectInjector;

import com.google.inject.Guice;

public class ShopLauncher {

    public static void main(String[] args) {
        // enable injection of actions
        ObjectInjector.setInjector(Guice
                .createInjector(new ShopInjectorModule()));
    }

}
}}}